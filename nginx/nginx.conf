# NGINX Configuration f체r Automation Challenge
# Aufgabe 1: HTTP Webserver
# Aufgabe 2: HTTPS wird sp채ter hinzugef체gt

server {
    # HTTP Server - Port 80
    listen 80;
    listen [::]:80;
    
    server_name localhost automation-challenge.cgi.com;
    
    # Root Directory f체r HTML Files
    root /usr/share/nginx/html;
    index index.html;
    
    # Logging
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;
    
    # Main location
    location / {
        try_files $uri $uri/ =404;
    }
    
    # Security Headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Cache static files
    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
        expires 7d;
        add_header Cache-Control "public, immutable";
    }
}

# ---- HTTPS: localhost ----
server {
    listen 443 ssl;
    listen [::]:443 ssl;

    server_name localhost;

    ssl_certificate     /etc/nginx/ssl/localhost.crt;
    ssl_certificate_key /etc/nginx/ssl/localhost.key;

    ssl_protocols TLSv1.2 TLSv1.3;

    root /usr/share/nginx/html;
    index index.html;

    location / { try_files $uri $uri/ =404; }
}

# ---- HTTPS: automation-challenge.cgi.com ----
server {
    listen 443 ssl;
    listen [::]:443 ssl;

    server_name automation-challenge.cgi.com;

    ssl_certificate     /etc/nginx/ssl/automation-challenge.crt;
    ssl_certificate_key /etc/nginx/ssl/automation-challenge.key;

    ssl_protocols TLSv1.2 TLSv1.3;

    root /usr/share/nginx/html;
    index index.html;

    location / { try_files $uri $uri/ =404; }
}
